<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Use Case Lab â€” Architecture Reference</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <!-- Simple Fiori-inspired styling -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fundamental-styles@latest/dist/fundamental-styles.min.css" />
  <style>
    body {
      background: #f4f7fa;
      font-family: "72", Arial, sans-serif;
      margin: 0;
      color: #222;
    }
    .header {
      background: #fff;
      border-bottom: 2px solid #dedede;
      padding: 24px 16px 8px 16px;
      margin-bottom: 0;
      display: flex;
      flex-wrap: wrap;
      align-items: flex-end;
      justify-content: space-between;
    }
    .header-title {
      font-size: 2rem;
      font-weight: 700;
      color: #0057ad;
      display: flex;
      align-items: center;
    }
    .header-title img {
      height: 44px;
      margin-right: 18px;
    }
    .header-actions {
      display: flex;
      gap: 10px;
      margin-top: 8px;
    }
    .container {
      display: flex;
      min-height: 80vh;
      padding: 0 16px 32px 16px;
      gap: 2rem;
      flex-wrap: wrap;
    }
    .sidebar {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 8px #0001;
      width: 370px;
      min-width: 320px;
      max-width: 98vw;
      padding: 20px 12px 20px 12px;
      margin-top: 2rem;
      flex-shrink: 0;
      height: fit-content;
    }
    .usecase-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .usecase-list li {
      padding: 12px 10px;
      border-bottom: 1px solid #e0e0e0;
      cursor: pointer;
      transition: background 0.15s;
    }
    .usecase-list li:hover, .usecase-list li.selected {
      background: #e7f3ff;
    }
    .tag {
      display: inline-block;
      background: #eaf2fa;
      color: #2176ae;
      padding: 2px 10px;
      border-radius: 9px;
      font-size: 0.93em;
      margin-right: 6px;
      margin-bottom: 2px;
      font-weight: 500;
    }
    .main-panel {
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 2px 8px #0001;
      padding: 30px 32px 24px 32px;
      flex: 1 1 360px;
      min-width: 360px;
      margin-top: 2rem;
      overflow-x: auto;
      max-width: 100vw;
      position: relative;
    }
    .main-panel h2 {
      margin-top: 0;
      color: #0057ad;
      font-weight: 700;
      letter-spacing: -1px;
    }
    .main-panel .embed-container {
      margin-top: 20px;
      margin-bottom: 14px;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid #eee;
      background: #fafbfc;
      min-height: 320px;
      max-width: 98vw;
    }
    .links-list {
      margin: 18px 0 8px 0;
      padding-left: 1.1em;
    }
    .links-list li {
      margin-bottom: 4px;
    }
    .expand {
      max-height: 1200px;
      overflow: auto;
      transition: max-height 0.4s cubic-bezier(.59,1.37,.5,1);
    }
    .collapse {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s cubic-bezier(.59,1.37,.5,1);
    }
    .modal-backdrop {
      background: rgba(0,0,0,0.18);
      position: fixed; left:0; right:0; top:0; bottom:0;
      z-index: 998;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background: #fff;
      padding: 2rem 2.2rem;
      border-radius: 12px;
      box-shadow: 0 6px 32px #0003;
      min-width: 310px;
      width: 98vw;
      max-width: 410px;
    }
    @media (max-width: 800px) {
      .container { flex-direction: column; gap: 0;}
      .sidebar, .main-panel { margin-top: 1.2rem; }
      .main-panel { padding: 18px 4vw 18px 4vw; }
    }
  </style>
</head>
<body>
  <div class="header">
    <span class="header-title">
      <!-- Replace src with your SAP-style icon if available -->
      <img src="https://www.sap.com/dam/application/shared/logos/sap-logo-svg.svg" alt="SAP" />
      Use Case Lab <span style="font-weight:400; color:#223;">&nbsp;|&nbsp;Architecture Reference</span>
    </span>
    <div class="header-actions">
      <button class="fd-button fd-button--emphasized" onclick="showAddModal()">Add Use Case</button>
      <input type="text" id="filterInput" class="fd-input" placeholder="Filter by tag or keyword" style="min-width:160px;">
    </div>
  </div>
  <div class="container">
    <aside class="sidebar">
      <h4 style="margin-top:0">Use Cases</h4>
      <ul class="usecase-list" id="usecaseList"></ul>
      <div id="noResults" style="display:none; margin-top:18px; color:#aaa;">No results found.</div>
    </aside>
    <main class="main-panel">
      <div id="details" style="color:#888;">Select a use case from the list.</div>
    </main>
  </div>

  <!-- Add Use Case Modal -->
  <div id="modalBackdrop" class="modal-backdrop" style="display:none;">
    <form class="modal-content" id="addForm" onsubmit="addUseCase(event)">
      <h3 style="margin-top:0;">Add New Use Case</h3>
      <div class="fd-form-item">
        <label class="fd-form-label" for="title">Title*</label>
        <input class="fd-input" id="title" required maxlength="90" placeholder="Short, unique name" autocomplete="off"/>
      </div>
      <div class="fd-form-item">
        <label class="fd-form-label" for="description">Description*</label>
        <textarea class="fd-textarea" id="description" required maxlength="1200" rows="3" placeholder="What does it do, for whom, and why is it interesting?"></textarea>
      </div>
      <div class="fd-form-item">
        <label class="fd-form-label" for="embed_url">Architecture Embed URL</label>
        <input class="fd-input" id="embed_url" type="url" maxlength="300" placeholder="https://..." />
        <span style="color:#999;font-size:0.9em;">Lucid, PDF, or other embed URL</span>
      </div>
      <div class="fd-form-item">
        <label class="fd-form-label">Customer Use Case Links (up to 3, optional):</label>
        <input class="fd-input" type="url" id="link1_url" maxlength="300" placeholder="Link 1 URL (https://...)" />
        <input class="fd-input" type="text" id="link1_label" maxlength="100" placeholder="Link 1 Label" style="margin-bottom:4px"/>
        <input class="fd-input" type="url" id="link2_url" maxlength="300" placeholder="Link 2 URL (https://...)" />
        <input class="fd-input" type="text" id="link2_label" maxlength="100" placeholder="Link 2 Label" style="margin-bottom:4px"/>
        <input class="fd-input" type="url" id="link3_url" maxlength="300" placeholder="Link 3 URL (https://...)" />
        <input class="fd-input" type="text" id="link3_label" maxlength="100" placeholder="Link 3 Label" />
      </div>
      <div class="fd-form-item">
        <label class="fd-form-label">Tags (comma separated, e.g. AI, Integration, MRO)</label>
        <input class="fd-input" id="tagInput" maxlength="120" placeholder="AI, Analytics, AppDev" />
      </div>
      <div style="margin-top:20px; text-align:right;">
        <button type="button" class="fd-button fd-button--transparent" onclick="hideAddModal()">Cancel</button>
        <button class="fd-button fd-button--emphasized" type="submit">Add</button>
      </div>
      <div id="addFormMsg" style="margin-top:10px;color:#e00;"></div>
    </form>
  </div>

  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.42.7/dist/umd/supabase.min.js"></script>
  <script>
    // Replace with your Supabase project settings!
    const SUPABASE_URL = "https://cgsfmpkcewemokbegnnt.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNnc2ZtcGtjZXdlbW9rYmVnbm50Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM4MzMyNzIsImV4cCI6MjA2OTQwOTI3Mn0.-5paJnbUuFWoIRSVAYcx3LRPYH5_HRjwjYcupvRKYLc";
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // --- UI State ---
    let usecases = [];
    let filtered = [];
    let selected = null;

    // --- Modal control ---
    function showAddModal() {
      document.getElementById('addForm').reset();
      document.getElementById('addFormMsg').textContent = '';
      document.getElementById('modalBackdrop').style.display = '';
    }
    function hideAddModal() {
      document.getElementById('modalBackdrop').style.display = 'none';
    }
    document.getElementById('modalBackdrop').onclick = e => {
      if(e.target === document.getElementById('modalBackdrop')) hideAddModal();
    };

    // --- List rendering ---
    function renderList() {
      const list = document.getElementById('usecaseList');
      list.innerHTML = '';
      const results = filtered.length ? filtered : usecases;
      if (!results.length) {
        document.getElementById('noResults').style.display = '';
        return;
      }
      document.getElementById('noResults').style.display = 'none';
      results.forEach((uc, i) => {
        const item = document.createElement('li');
        item.className = selected && selected.id === uc.id ? 'selected' : '';
        item.innerHTML = `<b>${uc.title}</b><br>
          <span style="font-size:0.99em;color:#555;">${(uc.description||'').slice(0, 85)}${uc.description.length>85?'...':''}</span><br>
          ${Array.isArray(uc.tags) ? uc.tags.map(tag => `<span class="tag">${tag}</span>`).join('') : ''}`;
        item.onclick = () => showDetails(uc);
        list.appendChild(item);
      });
    }

    // --- Detail panel ---
    function showDetails(uc) {
      selected = uc;
      document.querySelectorAll('.usecase-list li').forEach(li=>li.classList.remove('selected'));
      const found = Array.from(document.getElementById('usecaseList').children).find(li=>li.textContent.includes(uc.title));
      if (found) found.classList.add('selected');
      let linksHtml = '';
      for (let i = 1; i <= 3; i++) {
        const url = uc[`link${i}_url`];
        const label = uc[`link${i}_label`];
        if (url) {
          linksHtml += `<li><a href="${url}" target="_blank" rel="noopener">${label || url}</a></li>`;
        }
      }
      let tagsHtml = (Array.isArray(uc.tags) && uc.tags.length)
        ? `<div style="margin-top:6px">${uc.tags.map(tag=>`<span class="tag">${tag}</span>`).join('')}</div>` : '';
      let embedHtml = '';
      if (uc.embed_url) {
        // Try to detect if it's PDF or Lucid
        if (uc.embed_url.match(/\.pdf($|\?)/i)) {
          embedHtml = `<iframe src="${uc.embed_url}" width="100%" height="430" style="border:none"></iframe>`;
        } else {
          embedHtml = `<iframe src="${uc.embed_url}" width="100%" height="430" allowfullscreen style="border:none"></iframe>`;
        }
      }
      document.getElementById('details').innerHTML = `
        <h2>${uc.title}</h2>
        <div style="font-size:1.06em; margin-bottom:10px;">${uc.description}</div>
        ${tagsHtml}
        <div class="embed-container">${embedHtml||''}</div>
        ${linksHtml ? `<div><b>Customer Use Case Links:</b><ul class="links-list">${linksHtml}</ul></div>` : ''}
        <div style="color:#aaa;font-size:0.9em; margin-top:20px">Last updated ${uc.updated_at ? new Date(uc.updated_at).toLocaleString() : 'N/A'}</div>
      `;
    }

    // --- Add use case ---
    async function addUseCase(e) {
      e.preventDefault();
      const form = e.target;
      const title = form.title.value.trim();
      const description = form.description.value.trim();
      const embed_url = form.embed_url.value.trim();
      const link1_url = form.link1_url.value.trim();
      const link1_label = form.link1_label.value.trim();
      const link2_url = form.link2_url.value.trim();
      const link2_label = form.link2_label.value.trim();
      const link3_url = form.link3_url.value.trim();
      const link3_label = form.link3_label.value.trim();
      const tags = (form.tagInput.value||'').split(',').map(t=>t.trim()).filter(Boolean);
      if (!title || !description) {
        document.getElementById('addFormMsg').textContent = 'Title and description are required.';
        return;
      }
      document.getElementById('addFormMsg').textContent = 'Saving...';
      // Insert to Supabase
      const { data, error } = await supabase.from('use_cases').insert([{
        title, description, embed_url,
        link1_url, link1_label,
        link2_url, link2_label,
        link3_url, link3_label,
        tags
      }]);
      if (error) {
        document.getElementById('addFormMsg').textContent = 'Error: ' + error.message;
        return;
      }
      hideAddModal();
      await loadData();
      // Show newly added use case
      if (data && data.length) showDetails(data[0]);
    }

    // --- Filter/search ---
    document.getElementById('filterInput').addEventListener('input', function() {
      const v = this.value.trim().toLowerCase();
      if (!v) {
        filtered = [];
        renderList();
        return;
      }
      filtered = usecases.filter(uc =>
        (uc.title||'').toLowerCase().includes(v) ||
        (uc.description||'').toLowerCase().includes(v) ||
        (Array.isArray(uc.tags) && uc.tags.some(tag => tag.toLowerCase().includes(v)))
      );
      renderList();
    });

    // --- Load data ---
    async function loadData() {
      const { data, error } = await supabase
        .from('use_cases')
        .select('*')
        .order('updated_at', { ascending: false });
      usecases = (data || []);
      filtered = [];
      renderList();
      document.getElementById('details').innerHTML = 'Select a use case from the list.';
      selected = null;
    }

    // --- On load ---
    loadData();

  </script>
</body>
</html>
